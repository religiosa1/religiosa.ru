---
import type { MarkdownInstance } from "astro";
import type { MarkdownRecipeMatter } from '$/models/MarkdownRecipeMatter';
import BaseLayout from '$/components/BaseLayout.astro';
import { Breadcrumbs, BreadcrumbsLink } from "$/components/Breadcrumbs";
import Duration from "$/components/Duration.astro";

interface Props {
  article: MarkdownInstance<MarkdownRecipeMatter>;
  recommended: MarkdownInstance<MarkdownRecipeMatter>[];
}

export async function getStaticPaths() {
  const articles = await Astro.glob<MarkdownRecipeMatter>('../../content/recepies/*.md');
  return articles.map((article) => ({
    params: { slug: article.frontmatter.slug, },
    props: {
      article,
      recommended: article.frontmatter.recommended?.length ?
        article.frontmatter.recommended.map( i => articles.find(j => j.frontmatter.slug === i))
        : [],
    },
  }) );
}

const { article, recommended } = Astro.props as Props;
---

<BaseLayout title={article.frontmatter.title}>
  <h2>{article.frontmatter.title}</h2>
  { article.frontmatter.originalTitle && (
    <i class="original-title">{article.frontmatter.originalTitle}</i>
  )}

  <Breadcrumbs current={article.frontmatter.title}>
    <BreadcrumbsLink to="/">Главная страница</BreadcrumbsLink>
    <BreadcrumbsLink to="/recepies/">Кулинарные рецепты</BreadcrumbsLink>
  </Breadcrumbs>

  <article>

    { article.frontmatter.time && <Duration value={article.frontmatter.time}>Время приготовления</Duration> }
    { article.frontmatter.waiting && <Duration value={article.frontmatter.waiting}>Время ожидания</Duration> }

    { article.frontmatter.ingredients?.length > 0 && (<>
      <h3>Ингредиенты</h3>
      <ul class="ingredients">
        { article.frontmatter.ingredients.map((ingredient) => (
          <li class="ingredients__item">
            <h5 class="ingredient__name">{ingredient.name}</h5>
            <span class="ingredient__quant">{ingredient.quant}</span>
            <i class="ingredient__alt">{ingredient.alt}</i>
            <i class="ingredient__desc">{ingredient.desc}</i>
          </li>
        )) }
      </ul>
    </>)}

    <h3>Инструкции</h3>
    <article.Content />

    { article.frontmatter.sources?.length > 0 && (<>
      <h3>Источники</h3>
      { article.frontmatter.sources.map(source => (
        <a href={source} class="b-link">{source}</a>
      ))}
    </>)}

    { recommended?.length > 0 && (<>
      <h3>Рекомендации</h3>
      { recommended.filter(r => r).map(r => (
        <a href={"/recepies/" + r.frontmatter.slug} class="b-link">{r.frontmatter.title}</a>
      ))}
    </>)}
  </article>
</BaseLayout>

<style>
  .ingredients {
    list-style: none;
    margin: 1rem 0;
    padding: 0;
  }
  .ingredients__item {
    display: flex;
    flex-flow: row nowrap;
    align-items: center;
    justify-content: flex-start;
    gap: 1rem;
    margin: 0.3rem 0;
    padding: 0;
  }
  .ingredient__name {
    margin: 0;
    font-size: 1rem;
    font-weight: 500;
    font-style: italic;
  }
  .b-link {
    display: block;
    margin: 0 0 0.5rem;
  }
</style>